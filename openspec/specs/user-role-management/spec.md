# user-role-management Specification

## Purpose
TBD - created by archiving change implement-admin-functions. Update Purpose after archive.
## Requirements
### Requirement: Seller Account Creation
The system MUST allow administrators to create new seller accounts **through the admin dashboard interface** by providing name, email, and optional password **with automatic credential generation support**.

#### Scenario: Admin Creates Seller via Dashboard
- **GIVEN** an authenticated administrator is on the admin dashboard
- **WHEN** they navigate to the "Create Seller" section and submit valid details
- **THEN** a new user with the "seller" role is created
- **AND** the seller appears in the user list immediately
- **AND** the admin receives the temporary credentials to share with the seller
- **AND** an audit log entry is created

### Requirement: User Activation Control
The system MUST allow administrators to activate or deactivate any user account (except their own).

#### Scenario: Deactivate Seller
- **WHEN** an administrator clicks "Deactivate" on an active seller account
- **THEN** the seller's `isActive` status is set to false and they cannot log in.

### Requirement: Admin Management
The system MUST allow administrators to promote or demote other users to "admin" role.

#### Scenario: Promote User to Admin
- **WHEN** an administrator changes a regular user's role to "admin"
- **THEN** that user gains access to all administrative functions upon next login.

### Requirement: Profile Management
Authenticated users MUST be able to manage their own personal profile information, including contact details and address.

#### Scenario: Update Personal Details
- **WHEN** a logged-in user updates their phone number and address in the settings panel
- **THEN** the changes are saved and persist across sessions.

### Requirement: User Data Persistence
User accounts MUST be stored in a PostgreSQL database with proper data integrity and security.

#### Scenario: User Registration with Database
- **GIVEN** a new user submits registration details
- **WHEN** the registration is processed
- **THEN** the user record is inserted into the database
- **AND** the password is hashed before storage
- **AND** a unique ID is generated by the database
- **AND** the user data persists across server restarts

#### Scenario: Duplicate Email Prevention
- **GIVEN** a user exists with email "test@example.com"
- **WHEN** another user attempts to register with the same email
- **THEN** the database rejects the insertion due to unique constraint
- **AND** a user-friendly error message is returned

### Requirement: Authentication with Database
User authentication MUST query the database for credential verification.

#### Scenario: Login with Database Lookup
- **GIVEN** a registered user with email and password
- **WHEN** the user attempts to login
- **THEN** the system queries the database for the user by email
- **AND** verifies the password against the stored hash
- **AND** updates the lastLogin timestamp in the database
- **AND** returns a JWT token on success

### Requirement: Admin Seller Account Creation
Administrators MUST be able to create new seller accounts directly through the admin dashboard with complete user details and automatic credential generation.

#### Scenario: Create Seller Account with Auto-Generated Password
- **GIVEN** an authenticated administrator accesses the seller creation form
- **WHEN** they submit valid details (name, email) without providing a password
- **THEN** a new user with role "seller" is created in the database
- **AND** a secure random password is automatically generated
- **AND** the password is hashed before storage
- **AND** the temporary password is returned to the admin (displayed once)
- **AND** the seller account is immediately active

#### Scenario: Create Seller Account with Custom Password
- **GIVEN** an authenticated administrator accesses the seller creation form
- **WHEN** they submit valid details including a custom password
- **THEN** the password is validated for strength requirements
- **AND** if valid, a new seller account is created with the provided password
- **AND** the password is hashed before storage
- **AND** the account is immediately active

#### Scenario: Prevent Duplicate Seller Email
- **GIVEN** a seller account exists with email "seller@example.com"
- **WHEN** an administrator attempts to create another seller with the same email
- **THEN** the creation is rejected with a validation error
- **AND** an error message indicates the email is already in use

#### Scenario: Admin-Only Access to Seller Creation
- **GIVEN** a user with role "seller" or "user" is authenticated
- **WHEN** they attempt to access the seller creation endpoint
- **THEN** the request is rejected with a 403 Forbidden status
- **AND** an error message indicates insufficient permissions

### Requirement: Admin Action Audit Logging
All administrative actions MUST be logged in an audit trail for security and compliance purposes.

#### Scenario: Log Seller Account Creation
- **GIVEN** an administrator creates a new seller account
- **WHEN** the account is successfully created
- **THEN** an audit log entry is created in the `admin_actions` table
- **AND** the log includes the admin's ID, action type ("create_seller"), target user ID, and timestamp
- **AND** additional details (email, name) are stored in the `details` JSONB field

#### Scenario: Query Admin Action History
- **GIVEN** multiple admin actions have been logged
- **WHEN** an administrator requests the audit log
- **THEN** all logged actions are returned in reverse chronological order
- **AND** each entry includes admin name, action type, target, and timestamp
- **AND** sensitive information (passwords) is excluded from the log

